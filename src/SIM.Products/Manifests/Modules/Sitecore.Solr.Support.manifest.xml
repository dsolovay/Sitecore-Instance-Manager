<manifest version="1.3">
  <archive>
    <name>Sitecore Solr Support</name>
    <!-- TODO Restrict for Sitecore 8 -->
    <install>
      <params>
          <param name="{IOC Option}" title="Select Solr IOC configuration" defaultValue="AutoFac" mode="select" options="AutoFac|CastleWindsor|Ninject|StructureMap|Unity" />
        </params>
      <actions>
        <extract />
        
        <!-- Disable Lucene configuration files -->
        <!-- TODO Is there a way to dynamically replace Lucene versions with Solr versions, if available, so that this plays well with other modules? -->
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.DefaultIndexConfiguration.config" >
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.DefaultIndexConfiguration.config.disabled" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Analytics.config" >
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Analytics.config.disabled" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Core.config" >
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Core.config.disabled" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Master.config" >
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Master.config.disabled" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Web.config" >
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Lucene.Index.Web.config.disabled" />
        </editfile>
        <!-- Enable Solr configuration files, rename Core to include instance -->
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.DefaultIndexConfiguration.config.example" >
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.DefaultIndexConfiguration.config" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Analytics.config.example" >
          <replace source="&lt;param desc=&quot;core&quot;&gt;$(id)&lt;/param&gt;"
                   target="&lt;param desc=&quot;core&quot;&gt;{InstanceName}_$(id)&lt;/param&gt;"/>
          <replacevariables />
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Analytics.config" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Core.config.example" >
          <replace source="&lt;param desc=&quot;core&quot;&gt;$(id)&lt;/param&gt;"
                  target="&lt;param desc=&quot;core&quot;&gt;{InstanceName}_$(id)&lt;/param&gt;"/>
          <replacevariables />
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Core.config" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Master.config.example" >
          <replace source="&lt;param desc=&quot;core&quot;&gt;$(id)&lt;/param&gt;"
                  target="&lt;param desc=&quot;core&quot;&gt;{InstanceName}_$(id)&lt;/param&gt;"/>
          <replacevariables />
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Master.config" />
        </editfile>
        <editfile path="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Web.config.example" >
          <replace source="&lt;param desc=&quot;core&quot;&gt;$(id)&lt;/param&gt;"
                  target="&lt;param desc=&quot;core&quot;&gt;{InstanceName}_$(id)&lt;/param&gt;"/>
          <replacevariables />
          <move target="/Website/App_Config/Include/Sitecore.ContentSearch.Solr.Index.Web.config" />
        </editfile>
        <!-- Update Global.asax-->
        <editfile path="/Website/Global.asax" condition="not equals" conditionArg1="{IOC Option}" conditionArg2="CastleWindsor">
          <replace source="Sitecore.Web.Application" target="Sitecore.ContentSearch.SolrProvider.{IOC Option}Integration.{IOC Option}Appliation"/>
          <replacevariables/>
        </editfile>
        <editfile path="/Website/Global.asax" condition="equals" conditionArg1="{IOC Option}" conditionArg2="CastleWindsor">
          <replace source="Sitecore.Web.Application" target="Sitecore.ContentSearch.SolrProvider.CastleWindsorIntegration.WindsorApplication"/>
          <replacevariables/>
        </editfile>
         
        
      </actions>
    </install>
  </archive>
</manifest>